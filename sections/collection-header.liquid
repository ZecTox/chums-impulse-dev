{%- assign disable_sticky_header = false -%}

{%- if section.settings.enable -%}
  {%- if section.settings.collection_image_enable and collection.image -%}
    {% liquid
      # Handle mobile images for collection banner
      # Added by Steve - 2025.01.28
      assign has_mobile_image = false
      assign mobile_image = null
      assign desktop_classes = 'collection-hero__image image-fit'
      if collection.metafields.custom.mobile_lifestyle != blank
        assign has_mobile_image = true
        assign mobile_image = collection.metafields.custom.mobile_lifestyle.value
        assign desktop_classes = 'small--hide collection-hero__image image-fit'
        style

        endstyle
      endif
    %}
    {% if has_mobile_image %}
      {% style %}
        @media only screen and (max-width: 767px) {
        .collection-hero {
        height: auto;
        }
        }
      {% endstyle %}
    {% endif %}

    <div
      id="CollectionHeaderSection"
      data-section-id="{{ section.id }}"
      data-section-type="collection-header"
      {% if section.settings.parallax %}data-parallax="true"{% endif %}>

      <div class="collection-hero">

      {%- if section.settings.parallax -%}
        <parallax-image class="parallax-container">
          <div class="parallax-image" data-movement="15%" data-parallax-image
               data-angle="{{ section.settings.parallax_direction }}">
            {%- endif -%}

            {%- render 'image-element',
              img: collection.image,
              img_width: 2400,
              classes: desktop_classes,
              preload: true,
              loading: 'eager',
            -%}
            {%- if has_mobile_image -%}
              {%- render 'image-element',
                img: mobile_image,
                classes: 'medium-up--hide collection-hero__image',
                preload: true,
                loading: 'eager',
              -%}
            {%- endif %}

            {%- if section.settings.parallax -%}
          </div>
        </parallax-image>
        {%- endif -%}

        {% if section.settings.collection_title_below == false %}
          <div class="collection-hero__content">
            <div class="page-width">
              <header class="section-header section-header--hero">
                <div class="section-header__shadow">
                  {%- render 'breadcrumbs' -%}
                  <h1 class="section-header__title">
                    {{ collection.title }}
                  </h1>
                </div>
              </header>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {%- else -%}
    {%- assign disable_sticky_header = true -%}
    <div class="page-width page-content page-content--top">
      <header class="section-header section-header--flush">
        {%- render 'breadcrumbs' -%}
        <h1 class="section-header__title">
          {{ collection.title }}
        </h1>
      </header>
    </div>
  {%- endif -%}
{% else %}
  {%- assign disable_sticky_header = true -%}
{%- endif -%}

{%- if disable_sticky_header -%}
  {% comment %}
    Div to trigger theme.CollectionHeader JS
  {% endcomment %}
  <div
    id="CollectionHeaderSection"
    data-section-id="{{ section.id }}"
    data-section-type="collection-header">
  </div>
{%- endif -%}

{% if section.settings.collection_title_below == true and collection.image %}
  <div class="collection-hero__title">
    <div class="page-width">
      <header class="section-header section-header--title">
        {%- render 'breadcrumbs' -%}
        <h1 class="section-header__title">
          {{ collection.title }}
        </h1>
      </header>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "t:sections.collection-header.name",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable",
      "label": "t:sections.collection-header.settings.enable.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "collection_image_enable",
      "label": "t:sections.collection-header.settings.collection_image_enable.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "parallax",
      "label": "t:sections.collection-header.settings.parallax.label",
      "default": true
    },
    {
      "type": "select",
      "id": "parallax_direction",
      "label": "t:sections.background-image-text.settings.parallax_direction.label",
      "default": "top",
      "options": [
        {
          "value": "top",
          "label": "t:sections.background-image-text.settings.parallax_direction.options.top.label"
        },
        {
          "value": "left",
          "label": "t:sections.background-image-text.settings.parallax_direction.options.left.label"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "collection_title_below",
      "label": "Show title below collection image",
      "default": false
    }
  ],
  "disabled_on": {
    "groups": [
      "footer",
      "header",
      "custom.popups"
    ]
  }
}
{% endschema %}
